var __defProp=Object.defineProperty,__hasOwnProp=Object.prototype.hasOwnProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,i)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,__assign=(e,t)=>{for(var i in t||(t={}))__hasOwnProp.call(t,i)&&__defNormalProp(e,i,t[i]);if(__getOwnPropSymbols)for(var i of __getOwnPropSymbols(t))__propIsEnum.call(t,i)&&__defNormalProp(e,i,t[i]);return e};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("vuex"),require("mini-notifier"),require("body-scroll-lock"),require("pentatrion-lib")):"function"==typeof define&&define.amd?define(["exports","vue","vuex","mini-notifier","body-scroll-lock","pentatrion-lib"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).miniFileManager={},e.Vue,e.Vuex,e.miniNotifier,e.bodyScrollLock,e.pentatrionLib)}(this,(function(e,t,i,a,n,o){"use strict";const r={data:()=>({sending:!1,uploadedFiles:0,filesToUpload:0,dropActive:!1,progressFilename:null,progressNumber:0,inputFileId:"file-"+Math.ceil(1e4*Math.random())}),computed:__assign(__assign(__assign({},i.mapState(["endPoints","currentEntryPoint","isAdmin"])),i.mapGetters(["completeDirectory"])),{canUpload(){return this.isAdmin||!this.currentEntryPoint.readOnly}}),methods:__assign(__assign({},i.mapMutations(["addFile","setFiles"])),{reset(){this.sending=!1,this.uploadedFiles=0,this.filesToUpload=0,this.progressNumber=0,this.progressFilename=null},highlight(){this.dropActive=!0},unhighlight(){this.dropActive=!1},handleDrop(e){this.unhighlight();let t=e.dataTransfer.files;this.handleFiles(t)},handleChange(e){let t=e.currentTarget.files;console.log("amont",this),this.handleFiles(t)},async handleFiles(e){if(0!==e.length){this.filesToUpload=e.length,this.sending=!0;for(let t of e)await this.uploadFile(t)}},uploadFile(e){let t=this;return new Promise((i=>{let n=new FormData;n.append("file",e),n.append("directory",this.completeDirectory),n.append("origin",this.currentEntryPoint.origin),this.progressFilename=e.name,this.progressNumber=0;let o=new XMLHttpRequest;o.upload.onprogress=function(e){e.lengthComputable&&(t.progressNumber=Math.round(100*e.loaded/e.total))},o.open("POST",this.endPoints.uploadFile),o.onload=function(){let e;t.progressNumber=100;try{e=JSON.parse(this.responseText),200===this.status&&e&&e.data?(console.log("addFile",t),t.addFile(e.data)):a.notify(e.title||e,{style:"error"})}catch(n){return void a.notify(this.responseText,{style:"error"})}finally{t.uploadedFiles++,t.checkFinished(),i()}},o.onerror=function(e){a.notify(e.target.statusText,{style:"error"}),t.uploadedFiles++,t.checkFinished(),i()},o.send(n)}))},checkFinished(){this.uploadedFiles<this.filesToUpload||this.reset()}})},s=t.withScopeId("data-v-3bb25c2e");t.pushScopeId("data-v-3bb25c2e");const l={key:0},c=t.createVNode("span",null,[t.createVNode("i",{class:"fa-doc-add"}),t.createTextVNode("Ajouter")],-1),h={key:1},d={class:"filename"},p={class:"counter ref"},u={key:1,class:"drop-area readonly"},f=t.createVNode("label",{class:"label"}," Répertoire en lecture seule. ",-1);t.popScopeId();const m=s(((e,i,a,n,o,r)=>null!==e.completeDirectory?(t.openBlock(),t.createBlock("div",l,[r.canUpload?(t.openBlock(),t.createBlock("div",{key:0,class:["drop-area",{highlight:o.dropActive,sending:o.sending}],onDragenter:i[2]||(i[2]=t.withModifiers(((...e)=>r.highlight&&r.highlight(...e)),["prevent","stop"])),onDragover:i[3]||(i[3]=t.withModifiers(((...e)=>r.highlight&&r.highlight(...e)),["prevent","stop"])),onDragleave:i[4]||(i[4]=t.withModifiers(((...e)=>r.unhighlight&&r.unhighlight(...e)),["prevent","stop"])),onDrop:i[5]||(i[5]=t.withModifiers(((...e)=>r.handleDrop&&r.handleDrop(...e)),["prevent","stop"]))},[t.createVNode("input",{type:"file",multiple:"",id:o.inputFileId,class:"input-file",disabled:o.sending,accept:"image/*,text/*,video/*,audio/*,.rtf,.pdf,.xml,font/*,.ods,.odt,.docx,.doc,.xlsx,.xls,.json,.ai,.zip",onChange:i[1]||(i[1]=(...e)=>r.handleChange&&r.handleChange(...e))},null,40,["id","disabled"]),o.sending?o.progressFilename?(t.openBlock(),t.createBlock("div",h,[t.createVNode("div",{class:"progress-value",style:{width:o.progressNumber+"%"}},null,4),t.createVNode("div",d,t.toDisplayString(o.progressFilename),1),t.createVNode("div",p,t.toDisplayString(o.uploadedFiles+1)+" / "+t.toDisplayString(o.filesToUpload),1)])):t.createCommentVNode("",!0):(t.openBlock(),t.createBlock("label",{key:0,class:"label",for:o.inputFileId},[c],8,["for"]))],34)):(t.openBlock(),t.createBlock("div",u,[f]))])):t.createCommentVNode("",!0)));r.render=m,r.__scopeId="data-v-3bb25c2e";const g={props:["files"],data:()=>({filename:"",ext:""}),computed:__assign(__assign({},i.mapState(["directory","editing","isAdmin","currentEntryPoint","endPoints","secondaryDirectories"])),{currentDirectoryName(){return this.secondaryDirectories.length>0?this.secondaryDirectories[this.secondaryDirectories.length-1]:this.currentEntryPoint.label},file(){return 1===this.files.length?this.files[0]:null}}),watch:{files(e){if(1===e.length){let t=e[0].filename,i=t.lastIndexOf(".");-1===i?(this.filename=t,this.ext=""):(this.filename=t.substring(0,i),this.ext=t.substring(i))}}},methods:__assign(__assign(__assign({},i.mapActions(["updateFilename","download","deleteSelectedFiles"])),i.mapMutations(["setEditing","setEditContent"])),{formatDate(e){let t=new Date(e);return t instanceof Date&&!isNaN(t)?new Intl.DateTimeFormat("fr-FR").format(t):""},formatRatio:e=>Math.round(100*e)/100,canEdit(e){return!!this.isAdmin||!this.currentEntryPoint.readOnly&&!e.readOnly},canEditContent:e=>!!e.details,copyToClipboard(){this.$refs.inputUrl.select(),document.execCommand("copy"),a.notify("URL copiée")},editContent(){this.setEditContent(this.file)},editFilename(){let e=this.filename+this.ext;this.editing?this.filename&&"."!==this.filename[0]?e!==this.file.filename&&this.updateFilename({file:this.file,newFilename:e}):a.notify("Nom de fichier non valide.",{style:"error"}):setTimeout((()=>{this.$refs.inputFilename.select()}),100),this.setEditing(!this.editing)},handleOpen(){this.file.url?window.open(this.file.url,"_blank"):window.open(`${window.location.origin}${this.endPoints.getFileContent}/show/${this.file.origin}/${this.file.uploadRelativePath}`,"_blank")},handleDownload(){let e=0===this.files.length?[this.directory]:this.files;this.download({files:e})}})},v=t.withScopeId("data-v-209a583d");t.pushScopeId("data-v-209a583d");const y={key:0,class:"infos"},b={key:0},w={class:"form-group"},k=t.createVNode("label",null,"Nom du dossier",-1),C={class:"form-group"},x=t.createVNode("label",null,"Accès",-1),D={key:0},N=t.createVNode("div",null,"Public",-1),M={key:1},B=t.createVNode("div",null,"Protégé",-1),V={class:"form-group"},F=t.createVNode("label",null,"Télécharger tout le dossier",-1),S=t.createVNode("i",{class:"fa-download"},null,-1),E={key:1},O={for:"name"},H=t.createTextVNode(" Nom "),W={key:0,class:"fa-ok"},L={key:1,class:"fa-pencil"},T={key:0},P={key:1},_={key:0,class:"input-with-button edit-filename"},I={class:"form-group compact"},R=t.createVNode("label",null,"Accès",-1),A={key:0},$={key:1},z={class:"form-group compact"},j=t.createVNode("label",null,"Ajouté le",-1),X={key:0,class:"form-group compact"},Y=t.createTextVNode(" Dimensions "),U=t.createVNode("i",{class:"fa-crop"},null,-1),q={class:"form-group compact"},G=t.createVNode("label",null,"Taille",-1),K={key:1,class:"form-group compact"},Q=t.createVNode("label",null,"URL",-1),Z={class:"file-url input-with-button"},J=t.createVNode("i",{class:"fa-clipboard"},null,-1),ee={class:"form-group btns"},te=t.createVNode("i",{class:"fa-trash"},null,-1),ie=t.createVNode("i",{class:"fa-eye"},null,-1),ae=t.createVNode("i",{class:"fa-download"},null,-1),ne={key:2};t.popScopeId();const oe=v(((e,i,a,n,o,r)=>e.directory?(t.openBlock(),t.createBlock("div",y,[0===a.files.length?(t.openBlock(),t.createBlock("div",b,[t.createVNode("div",w,[k,t.createVNode("div",null,t.toDisplayString(e.directory.filename),1)]),t.createVNode("div",C,[x,e.currentEntryPoint.url?(t.openBlock(),t.createBlock("div",D,[N])):(t.openBlock(),t.createBlock("div",M,[B]))]),t.createVNode("div",V,[F,t.createVNode("button",{class:"btn",onClick:i[1]||(i[1]=t.withModifiers(((...e)=>r.handleDownload&&r.handleDownload(...e)),["prevent"]))},[S])])])):1===a.files.length?(t.openBlock(),t.createBlock("div",E,[t.createVNode("form",{onSubmit:i[5]||(i[5]=t.withModifiers(((...e)=>r.editFilename&&r.editFilename(...e)),["prevent"])),class:"form-group filename"},[t.createVNode("label",O,[H,r.canEdit(r.file)?(t.openBlock(),t.createBlock("button",{key:0,href:"#",class:"with-icon btn-factice",onClick:i[2]||(i[2]=t.withModifiers(((...e)=>r.editFilename&&r.editFilename(...e)),["prevent"]))},[e.editing?(t.openBlock(),t.createBlock("i",W)):(t.openBlock(),t.createBlock("i",L))])):t.createCommentVNode("",!0)]),r.canEdit(r.file)?(t.openBlock(),t.createBlock("div",P,[e.editing?(t.openBlock(),t.createBlock("div",_,[t.withDirectives(t.createVNode("input",{type:"text",size:"1",class:"input-filename",ref:"inputFilename","onUpdate:modelValue":i[3]||(i[3]=t=>e.filename=t)},null,512),[[t.vModelText,e.filename]]),t.createVNode("span",null,t.toDisplayString(e.ext),1)])):(t.openBlock(),t.createBlock("div",{key:1,class:"div-filename",onClick:i[4]||(i[4]=t.withModifiers(((...e)=>r.editFilename&&r.editFilename(...e)),["prevent"]))},t.toDisplayString(r.file.filename),1))])):(t.openBlock(),t.createBlock("div",T,[t.createVNode("div",null,t.toDisplayString(r.file.filename),1)]))],32),t.createVNode("div",I,[R,r.canEdit(r.file)?(t.openBlock(),t.createBlock("div",A,"Lecture et modification")):(t.openBlock(),t.createBlock("div",$,"Lecture seule"))]),t.createVNode("div",z,[j,t.createVNode("div",null,t.toDisplayString(r.formatDate(r.file.createdAt)),1)]),"image"===r.file.mimeGroup&&r.file.details?(t.openBlock(),t.createBlock("div",X,[t.createVNode("label",null,[Y,r.canEditContent(r.file)?(t.openBlock(),t.createBlock("button",{key:0,class:"btn-factice with-icon",onClick:i[6]||(i[6]=(...e)=>r.editContent&&r.editContent(...e))},[U])):t.createCommentVNode("",!0)]),t.createVNode("div",null,t.toDisplayString(r.file.details.width)+" x "+t.toDisplayString(r.file.details.height)+" pixels",1),t.createVNode("div",null,"ratio : "+t.toDisplayString(r.formatRatio(r.file.details.ratio)),1)])):t.createCommentVNode("",!0),t.createVNode("div",q,[G,t.createVNode("div",null,t.toDisplayString(r.file.humanSize),1)]),r.file.url?(t.openBlock(),t.createBlock("div",K,[Q,t.createVNode("div",Z,[t.createVNode("input",{size:"1",class:"form-input",ref:"inputUrl",onFocus:i[7]||(i[7]=e=>e.target.select()),type:"text",readOnly:"",value:r.file.url},null,40,["value"]),t.createVNode("a",{href:"#",onClick:i[8]||(i[8]=t.withModifiers(((...e)=>r.copyToClipboard&&r.copyToClipboard(...e)),["prevent"])),class:"btn outlined btn-factice"},[J])])])):t.createCommentVNode("",!0),t.createVNode("div",ee,[r.canEdit(r.file)?(t.openBlock(),t.createBlock("button",{key:0,class:"btn btn-outlined",onClick:i[9]||(i[9]=t.withModifiers(((...t)=>e.deleteSelectedFiles&&e.deleteSelectedFiles(...t)),["prevent"]))},[te])):t.createCommentVNode("",!0),r.file&&!r.file.isDir?(t.openBlock(),t.createBlock("button",{key:1,class:"btn btn-outlined",onClick:i[10]||(i[10]=t.withModifiers(((...e)=>r.handleOpen&&r.handleOpen(...e)),["prevent"]))},[ie])):t.createCommentVNode("",!0),t.createVNode("button",{class:"btn",onClick:i[11]||(i[11]=t.withModifiers(((...e)=>r.handleDownload&&r.handleDownload(...e)),["prevent"]))},[ae])])])):a.files.length>1?(t.openBlock(),t.createBlock("div",ne,t.toDisplayString(a.files.length)+" éléments sélectionnés ",1)):t.createCommentVNode("",!0)])):t.createCommentVNode("",!0)));g.render=oe,g.__scopeId="data-v-209a583d";const re={props:["options","placeholder","modelValue","splitButton"],emit:["update:modelValue"],data:()=>({isOpen:!1,focusListener:null}),computed:{spinnerClass(){return this.isOpen?"fa-up-open":"fa-down-open"},valueLabel(){return this.modelValue?this.modelValue.label:this.placeholder}},methods:{handleClickOption(e){this.isOpen=!1,this.$emit("update:modelValue",e)},handleClickSelect(e){this.splitButton?this.$emit("click",this.modelValue):this.isOpen=!this.isOpen},handleClickContainer(e){this.isOpen=!1},handleClickSplit(e){this.isOpen=!this.isOpen}}},se=t.withScopeId("data-v-2890adc0");t.pushScopeId("data-v-2890adc0");const le={key:0},ce={key:1,class:"select-items"},he={key:0};t.popScopeId();const de=se(((e,i,a,n,o,r)=>(t.openBlock(),t.createBlock("div",{class:["custom-select",{"is-open":e.isOpen,"with-split-button":a.splitButton&&a.options.length>1}],onClick:i[3]||(i[3]=(...e)=>r.handleClickContainer&&r.handleClickContainer(...e))},[t.createVNode("a",{href:"#",class:"select-selected",tabindex:"0",onClick:i[1]||(i[1]=t.withModifiers(((...e)=>r.handleClickSelect&&r.handleClickSelect(...e)),["stop","prevent"]))},[a.modelValue&&a.modelValue.icon?(t.openBlock(),t.createBlock("span",le,[t.createVNode("i",{class:a.modelValue.icon},null,2)])):t.createCommentVNode("",!0),t.createTextVNode(" "+t.toDisplayString(r.valueLabel),1)]),a.splitButton&&a.options.length>1?(t.openBlock(),t.createBlock("a",{key:0,href:"#",tabindex:"0",class:"split-button",onClick:i[2]||(i[2]=t.withModifiers(((...e)=>r.handleClickSplit&&r.handleClickSplit(...e)),["stop","prevent"]))},[t.createVNode("i",{class:r.spinnerClass},null,2)])):t.createCommentVNode("",!0),e.isOpen?(t.openBlock(),t.createBlock("div",ce,[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(a.options,(e=>(t.openBlock(),t.createBlock("a",{href:"#",onClick:t.withModifiers((t=>r.handleClickOption(e)),["stop","prevent"]),key:e.value,class:"select-item"},[e.icon?(t.openBlock(),t.createBlock("span",he,[t.createVNode("i",{class:e.icon},null,2)])):t.createCommentVNode("",!0),t.createTextVNode(" "+t.toDisplayString(e.label),1)],8,["onClick"])))),128))])):t.createCommentVNode("",!0)],2))));re.render=de,re.__scopeId="data-v-2890adc0";const pe={props:["file"],methods:{formatDate(e){let t=new Date(e);return t instanceof Date&&!isNaN(t)?new Intl.DateTimeFormat("fr-FR").format(t):""}}},ue=t.withScopeId("data-v-2100a174");t.pushScopeId("data-v-2100a174");const fe={class:"filename"},me={class:"size ref"},ge={class:"date ref"};t.popScopeId();const ve=ue(((e,i,a,n,o,r)=>(t.openBlock(),t.createBlock("a",{href:"#",class:"file",onClick:i[1]||(i[1]=t.withModifiers((t=>e.$emit("click",t)),["prevent"])),onDblclick:i[2]||(i[2]=t=>e.$emit("dblclick",t))},[t.createVNode("div",fe,t.toDisplayString(a.file.filename),1),t.createVNode("div",me,t.toDisplayString(a.file.humanSize),1),t.createVNode("div",ge,t.toDisplayString(r.formatDate(a.file.createdAt)),1)],32))));pe.render=ve,pe.__scopeId="data-v-2100a174";const ye={props:["file"],computed:{},methods:{iconPath(e){var t;return(null==(t=e.thumbnails)?void 0:t.small)?e.thumbnails.small:e.icon},isIcon(e){var t;return!(null==(t=e.thumbnails)?void 0:t.small)},handleDragStart(e,t){t.url&&(e.dataTransfer.setData("text/html",`<img src="${t.url}">`),e.dataTransfer.setData("text/plain",t.url),e.dataTransfer.setData("application/x-editor-js",t.url))}}},be=t.withScopeId("data-v-fc37bbba");t.pushScopeId("data-v-fc37bbba");const we={class:"square"},ke={class:"filename"};t.popScopeId();const Ce=be(((e,i,a,n,o,r)=>(t.openBlock(),t.createBlock("a",{href:"#",class:"file",onClick:i[2]||(i[2]=t.withModifiers((t=>e.$emit("click",t)),["prevent"])),onDblclick:i[3]||(i[3]=t=>e.$emit("dblclick",t))},[t.createVNode("div",we,[t.createVNode("div",{class:["img-container",{"is-icon":r.isIcon(a.file),"is-not-icon":!r.isIcon(a.file)}]},[t.createVNode("img",{onDragstart:i[1]||(i[1]=e=>r.handleDragStart(e,a.file)),alt:a.file.filename,src:r.iconPath(a.file)},null,40,["alt","src"])],2)]),t.createVNode("div",ke,t.toDisplayString(a.file.label||a.file.filename),1)],32))));
/*!
   * Cropper.js v1.5.11
   * https://fengyuanchen.github.io/cropperjs
   *
   * Copyright 2015-present Chen Fengyuan
   * Released under the MIT license
   *
   * Date: 2021-02-17T11:53:27.572Z
   */
function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Me(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Be(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function Ve(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(i),!0).forEach((function(t){Me(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Be(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Fe(e){return function(e){if(Array.isArray(e))return Se(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Se(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Se(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}ye.render=Ce,ye.__scopeId="data-v-fc37bbba";var Ee="undefined"!=typeof window&&void 0!==window.document,Oe=Ee?window:{},He=!(!Ee||!Oe.document.documentElement)&&"ontouchstart"in Oe.document.documentElement,We=!!Ee&&"PointerEvent"in Oe,Le="cropper",Te="all",Pe="crop",_e="move",Ie="zoom",Re="e",Ae="w",$e="s",ze="n",je="ne",Xe="nw",Ye="se",Ue="sw",qe="".concat(Le,"-crop"),Ge="".concat(Le,"-disabled"),Ke="".concat(Le,"-hidden"),Qe="".concat(Le,"-hide"),Ze="".concat(Le,"-invisible"),Je="".concat(Le,"-modal"),et="".concat(Le,"-move"),tt="".concat(Le,"Action"),it="".concat(Le,"Preview"),at="crop",nt="move",ot="none",rt="crop",st="cropend",lt="cropmove",ct="cropstart",ht="dblclick",dt=We?"pointerdown":He?"touchstart":"mousedown",pt=We?"pointermove":He?"touchmove":"mousemove",ut=We?"pointerup pointercancel":He?"touchend touchcancel":"mouseup",ft="ready",mt="resize",gt="wheel",vt="zoom",yt="image/jpeg",bt=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,wt=/^data:/,kt=/^data:image\/jpeg;base64,/,Ct=/^img|canvas$/i,xt={viewMode:0,dragMode:at,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Dt=Number.isNaN||Oe.isNaN;function Nt(e){return"number"==typeof e&&!Dt(e)}var Mt=function(e){return e>0&&e<1/0};function Bt(e){return void 0===e}function Vt(e){return"object"===xe(e)&&null!==e}var Ft=Object.prototype.hasOwnProperty;function St(e){if(!Vt(e))return!1;try{var t=e.constructor,i=t.prototype;return t&&i&&Ft.call(i,"isPrototypeOf")}catch(a){return!1}}function Et(e){return"function"==typeof e}var Ot=Array.prototype.slice;function Ht(e){return Array.from?Array.from(e):Ot.call(e)}function Wt(e,t){return e&&Et(t)&&(Array.isArray(e)||Nt(e.length)?Ht(e).forEach((function(i,a){t.call(e,i,a,e)})):Vt(e)&&Object.keys(e).forEach((function(i){t.call(e,e[i],i,e)}))),e}var Lt=Object.assign||function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++)i[a-1]=arguments[a];return Vt(e)&&i.length>0&&i.forEach((function(t){Vt(t)&&Object.keys(t).forEach((function(i){e[i]=t[i]}))})),e},Tt=/\.\d*(?:0|9){12}\d*$/;function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Tt.test(e)?Math.round(e*t)/t:e}var _t=/^width|height|left|top|marginLeft|marginTop$/;function It(e,t){var i=e.style;Wt(t,(function(e,t){_t.test(t)&&Nt(e)&&(e="".concat(e,"px")),i[t]=e}))}function Rt(e,t){if(t)if(Nt(e.length))Wt(e,(function(e){Rt(e,t)}));else if(e.classList)e.classList.add(t);else{var i=e.className.trim();i?i.indexOf(t)<0&&(e.className="".concat(i," ").concat(t)):e.className=t}}function At(e,t){t&&(Nt(e.length)?Wt(e,(function(e){At(e,t)})):e.classList?e.classList.remove(t):e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,"")))}function $t(e,t,i){t&&(Nt(e.length)?Wt(e,(function(e){$t(e,t,i)})):i?Rt(e,t):At(e,t))}var zt=/([a-z\d])([A-Z])/g;function jt(e){return e.replace(zt,"$1-$2").toLowerCase()}function Xt(e,t){return Vt(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(jt(t)))}function Yt(e,t,i){Vt(i)?e[t]=i:e.dataset?e.dataset[t]=i:e.setAttribute("data-".concat(jt(t)),i)}var Ut=/\s\s*/,qt=function(){var e=!1;if(Ee){var t=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(e){t=e}});Oe.addEventListener("test",i,a),Oe.removeEventListener("test",i,a)}return e}();function Gt(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i;t.trim().split(Ut).forEach((function(t){if(!qt){var o=e.listeners;o&&o[t]&&o[t][i]&&(n=o[t][i],delete o[t][i],0===Object.keys(o[t]).length&&delete o[t],0===Object.keys(o).length&&delete e.listeners)}e.removeEventListener(t,n,a)}))}function Kt(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i;t.trim().split(Ut).forEach((function(t){if(a.once&&!qt){var o=e.listeners,r=void 0===o?{}:o;n=function(){delete r[t][i],e.removeEventListener(t,n,a);for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];i.apply(e,s)},r[t]||(r[t]={}),r[t][i]&&e.removeEventListener(t,r[t][i],a),r[t][i]=n,e.listeners=r}e.addEventListener(t,n,a)}))}function Qt(e,t,i){var a;return Et(Event)&&Et(CustomEvent)?a=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,i),e.dispatchEvent(a)}function Zt(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Jt=Oe.location,ei=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function ti(e){var t=e.match(ei);return null!==t&&(t[1]!==Jt.protocol||t[2]!==Jt.hostname||t[3]!==Jt.port)}function ii(e){var t="timestamp=".concat((new Date).getTime());return e+(-1===e.indexOf("?")?"?":"&")+t}function ai(e){var t=e.rotate,i=e.scaleX,a=e.scaleY,n=e.translateX,o=e.translateY,r=[];Nt(n)&&0!==n&&r.push("translateX(".concat(n,"px)")),Nt(o)&&0!==o&&r.push("translateY(".concat(o,"px)")),Nt(t)&&0!==t&&r.push("rotate(".concat(t,"deg)")),Nt(i)&&1!==i&&r.push("scaleX(".concat(i,")")),Nt(a)&&1!==a&&r.push("scaleY(".concat(a,")"));var s=r.length?r.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function ni(e,t){var i=e.pageX,a=e.pageY,n={endX:i,endY:a};return t?n:Ve({startX:i,startY:a},n)}function oi(e){var t=e.aspectRatio,i=e.height,a=e.width,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",o=Mt(a),r=Mt(i);if(o&&r){var s=i*t;"contain"===n&&s>a||"cover"===n&&s<a?i=a/t:a=i*t}else o?i=a/t:r&&(a=i*t);return{width:a,height:i}}function ri(e,t,i,a){var n=t.aspectRatio,o=t.naturalWidth,r=t.naturalHeight,s=t.rotate,l=void 0===s?0:s,c=t.scaleX,h=void 0===c?1:c,d=t.scaleY,p=void 0===d?1:d,u=i.aspectRatio,f=i.naturalWidth,m=i.naturalHeight,g=a.fillColor,v=void 0===g?"transparent":g,y=a.imageSmoothingEnabled,b=void 0===y||y,w=a.imageSmoothingQuality,k=void 0===w?"low":w,C=a.maxWidth,x=void 0===C?1/0:C,D=a.maxHeight,N=void 0===D?1/0:D,M=a.minWidth,B=void 0===M?0:M,V=a.minHeight,F=void 0===V?0:V,S=document.createElement("canvas"),E=S.getContext("2d"),O=oi({aspectRatio:u,width:x,height:N}),H=oi({aspectRatio:u,width:B,height:F},"cover"),W=Math.min(O.width,Math.max(H.width,f)),L=Math.min(O.height,Math.max(H.height,m)),T=oi({aspectRatio:n,width:x,height:N}),P=oi({aspectRatio:n,width:B,height:F},"cover"),_=Math.min(T.width,Math.max(P.width,o)),I=Math.min(T.height,Math.max(P.height,r)),R=[-_/2,-I/2,_,I];return S.width=Pt(W),S.height=Pt(L),E.fillStyle=v,E.fillRect(0,0,W,L),E.save(),E.translate(W/2,L/2),E.rotate(l*Math.PI/180),E.scale(h,p),E.imageSmoothingEnabled=b,E.imageSmoothingQuality=k,E.drawImage.apply(E,[e].concat(Fe(R.map((function(e){return Math.floor(Pt(e))}))))),E.restore(),S}var si=String.fromCharCode;var li=/^data:.*,/;function ci(e){var t,i=new DataView(e);try{var a,n,o;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var r=i.byteLength,s=2;s+1<r;){if(255===i.getUint8(s)&&225===i.getUint8(s+1)){n=s;break}s+=1}if(n){var l=n+10;if("Exif"===function(e,t,i){var a="";i+=t;for(var n=t;n<i;n+=1)a+=si(e.getUint8(n));return a}(i,n+4,4)){var c=i.getUint16(l);if(((a=18761===c)||19789===c)&&42===i.getUint16(l+2,a)){var h=i.getUint32(l+4,a);h>=8&&(o=l+h)}}}if(o){var d,p,u=i.getUint16(o,a);for(p=0;p<u;p+=1)if(d=o+12*p+2,274===i.getUint16(d,a)){d+=8,t=i.getUint16(d,a),i.setUint16(d,1,a);break}}}catch(f){t=1}return t}var hi={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,t=this.options,i=this.container,a=this.cropper,n=Number(t.minContainerWidth),o=Number(t.minContainerHeight);Rt(a,Ke),At(e,Ke);var r={width:Math.max(i.offsetWidth,n>=0?n:200),height:Math.max(i.offsetHeight,o>=0?o:100)};this.containerData=r,It(a,{width:r.width,height:r.height}),Rt(e,Ke),At(a,Ke)},initCanvas:function(){var e=this.containerData,t=this.imageData,i=this.options.viewMode,a=Math.abs(t.rotate)%180==90,n=a?t.naturalHeight:t.naturalWidth,o=a?t.naturalWidth:t.naturalHeight,r=n/o,s=e.width,l=e.height;e.height*r>e.width?3===i?s=e.height*r:l=e.width/r:3===i?l=e.width/r:s=e.height*r;var c={aspectRatio:r,naturalWidth:n,naturalHeight:o,width:s,height:l};this.canvasData=c,this.limited=1===i||2===i,this.limitCanvas(!0,!0),c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),c.left=(e.width-c.width)/2,c.top=(e.height-c.height)/2,c.oldLeft=c.left,c.oldTop=c.top,this.initialCanvasData=Lt({},c)},limitCanvas:function(e,t){var i=this.options,a=this.containerData,n=this.canvasData,o=this.cropBoxData,r=i.viewMode,s=n.aspectRatio,l=this.cropped&&o;if(e){var c=Number(i.minCanvasWidth)||0,h=Number(i.minCanvasHeight)||0;r>1?(c=Math.max(c,a.width),h=Math.max(h,a.height),3===r&&(h*s>c?c=h*s:h=c/s)):r>0&&(c?c=Math.max(c,l?o.width:0):h?h=Math.max(h,l?o.height:0):l&&(c=o.width,(h=o.height)*s>c?c=h*s:h=c/s));var d=oi({aspectRatio:s,width:c,height:h});c=d.width,h=d.height,n.minWidth=c,n.minHeight=h,n.maxWidth=1/0,n.maxHeight=1/0}if(t)if(r>(l?0:1)){var p=a.width-n.width,u=a.height-n.height;n.minLeft=Math.min(0,p),n.minTop=Math.min(0,u),n.maxLeft=Math.max(0,p),n.maxTop=Math.max(0,u),l&&this.limited&&(n.minLeft=Math.min(o.left,o.left+(o.width-n.width)),n.minTop=Math.min(o.top,o.top+(o.height-n.height)),n.maxLeft=o.left,n.maxTop=o.top,2===r&&(n.width>=a.width&&(n.minLeft=Math.min(0,p),n.maxLeft=Math.max(0,p)),n.height>=a.height&&(n.minTop=Math.min(0,u),n.maxTop=Math.max(0,u))))}else n.minLeft=-n.width,n.minTop=-n.height,n.maxLeft=a.width,n.maxTop=a.height},renderCanvas:function(e,t){var i=this.canvasData,a=this.imageData;if(t){var n=function(e){var t=e.width,i=e.height,a=e.degree;if(90==(a=Math.abs(a)%180))return{width:i,height:t};var n=a%90*Math.PI/180,o=Math.sin(n),r=Math.cos(n),s=t*r+i*o,l=t*o+i*r;return a>90?{width:l,height:s}:{width:s,height:l}}({width:a.naturalWidth*Math.abs(a.scaleX||1),height:a.naturalHeight*Math.abs(a.scaleY||1),degree:a.rotate||0}),o=n.width,r=n.height,s=i.width*(o/i.naturalWidth),l=i.height*(r/i.naturalHeight);i.left-=(s-i.width)/2,i.top-=(l-i.height)/2,i.width=s,i.height=l,i.aspectRatio=o/r,i.naturalWidth=o,i.naturalHeight=r,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,It(this.canvas,Lt({width:i.width,height:i.height},ai({translateX:i.left,translateY:i.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var t=this.canvasData,i=this.imageData,a=i.naturalWidth*(t.width/t.naturalWidth),n=i.naturalHeight*(t.height/t.naturalHeight);Lt(i,{width:a,height:n,left:(t.width-a)/2,top:(t.height-n)/2}),It(this.image,Lt({width:i.width,height:i.height},ai(Lt({translateX:i.left,translateY:i.top},i)))),e&&this.output()},initCropBox:function(){var e=this.options,t=this.canvasData,i=e.aspectRatio||e.initialAspectRatio,a=Number(e.autoCropArea)||.8,n={width:t.width,height:t.height};i&&(t.height*i>t.width?n.height=n.width/i:n.width=n.height*i),this.cropBoxData=n,this.limitCropBox(!0,!0),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),n.width=Math.max(n.minWidth,n.width*a),n.height=Math.max(n.minHeight,n.height*a),n.left=t.left+(t.width-n.width)/2,n.top=t.top+(t.height-n.height)/2,n.oldLeft=n.left,n.oldTop=n.top,this.initialCropBoxData=Lt({},n)},limitCropBox:function(e,t){var i=this.options,a=this.containerData,n=this.canvasData,o=this.cropBoxData,r=this.limited,s=i.aspectRatio;if(e){var l=Number(i.minCropBoxWidth)||0,c=Number(i.minCropBoxHeight)||0,h=r?Math.min(a.width,n.width,n.width+n.left,a.width-n.left):a.width,d=r?Math.min(a.height,n.height,n.height+n.top,a.height-n.top):a.height;l=Math.min(l,a.width),c=Math.min(c,a.height),s&&(l&&c?c*s>l?c=l/s:l=c*s:l?c=l/s:c&&(l=c*s),d*s>h?d=h/s:h=d*s),o.minWidth=Math.min(l,h),o.minHeight=Math.min(c,d),o.maxWidth=h,o.maxHeight=d}t&&(r?(o.minLeft=Math.max(0,n.left),o.minTop=Math.max(0,n.top),o.maxLeft=Math.min(a.width,n.left+n.width)-o.width,o.maxTop=Math.min(a.height,n.top+n.height)-o.height):(o.minLeft=0,o.minTop=0,o.maxLeft=a.width-o.width,o.maxTop=a.height-o.height))},renderCropBox:function(){var e=this.options,t=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,e.movable&&e.cropBoxMovable&&Yt(this.face,tt,i.width>=t.width&&i.height>=t.height?_e:Te),It(this.cropBox,Lt({width:i.width,height:i.height},ai({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),Qt(this.element,rt,this.getData())}},di={initPreview:function(){var e=this.element,t=this.crossOrigin,i=this.options.preview,a=t?this.crossOriginUrl:this.url,n=e.alt||"The image to preview",o=document.createElement("img");if(t&&(o.crossOrigin=t),o.src=a,o.alt=n,this.viewBox.appendChild(o),this.viewBoxImage=o,i){var r=i;"string"==typeof i?r=e.ownerDocument.querySelectorAll(i):i.querySelector&&(r=[i]),this.previews=r,Wt(r,(function(e){var i=document.createElement("img");Yt(e,it,{width:e.offsetWidth,height:e.offsetHeight,html:e.innerHTML}),t&&(i.crossOrigin=t),i.src=a,i.alt=n,i.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',e.innerHTML="",e.appendChild(i)}))}},resetPreview:function(){Wt(this.previews,(function(e){var t=Xt(e,it);It(e,{width:t.width,height:t.height}),e.innerHTML=t.html,function(e,t){if(Vt(e[t]))try{delete e[t]}catch(i){e[t]=void 0}else if(e.dataset)try{delete e.dataset[t]}catch(i){e.dataset[t]=void 0}else e.removeAttribute("data-".concat(jt(t)))}(e,it)}))},preview:function(){var e=this.imageData,t=this.canvasData,i=this.cropBoxData,a=i.width,n=i.height,o=e.width,r=e.height,s=i.left-t.left-e.left,l=i.top-t.top-e.top;this.cropped&&!this.disabled&&(It(this.viewBoxImage,Lt({width:o,height:r},ai(Lt({translateX:-s,translateY:-l},e)))),Wt(this.previews,(function(t){var i=Xt(t,it),c=i.width,h=i.height,d=c,p=h,u=1;a&&(p=n*(u=c/a)),n&&p>h&&(d=a*(u=h/n),p=h),It(t,{width:d,height:p}),It(t.getElementsByTagName("img")[0],Lt({width:o*u,height:r*u},ai(Lt({translateX:-s*u,translateY:-l*u},e))))})))}},pi={bind:function(){var e=this.element,t=this.options,i=this.cropper;Et(t.cropstart)&&Kt(e,ct,t.cropstart),Et(t.cropmove)&&Kt(e,lt,t.cropmove),Et(t.cropend)&&Kt(e,st,t.cropend),Et(t.crop)&&Kt(e,rt,t.crop),Et(t.zoom)&&Kt(e,vt,t.zoom),Kt(i,dt,this.onCropStart=this.cropStart.bind(this)),t.zoomable&&t.zoomOnWheel&&Kt(i,gt,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&Kt(i,ht,this.onDblclick=this.dblclick.bind(this)),Kt(e.ownerDocument,pt,this.onCropMove=this.cropMove.bind(this)),Kt(e.ownerDocument,ut,this.onCropEnd=this.cropEnd.bind(this)),t.responsive&&Kt(window,mt,this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,t=this.options,i=this.cropper;Et(t.cropstart)&&Gt(e,ct,t.cropstart),Et(t.cropmove)&&Gt(e,lt,t.cropmove),Et(t.cropend)&&Gt(e,st,t.cropend),Et(t.crop)&&Gt(e,rt,t.crop),Et(t.zoom)&&Gt(e,vt,t.zoom),Gt(i,dt,this.onCropStart),t.zoomable&&t.zoomOnWheel&&Gt(i,gt,this.onWheel,{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&Gt(i,ht,this.onDblclick),Gt(e.ownerDocument,pt,this.onCropMove),Gt(e.ownerDocument,ut,this.onCropEnd),t.responsive&&Gt(window,mt,this.onResize)}},ui={resize:function(){if(!this.disabled){var e,t,i=this.options,a=this.container,n=this.containerData,o=a.offsetWidth/n.width;if(1!==o||a.offsetHeight!==n.height)i.restore&&(e=this.getCanvasData(),t=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(Wt(e,(function(t,i){e[i]=t*o}))),this.setCropBoxData(Wt(t,(function(e,i){t[i]=e*o}))))}},dblclick:function(){var e,t;this.disabled||this.options.dragMode===ot||this.setDragMode((e=this.dragBox,t=qe,(e.classList?e.classList.contains(t):e.className.indexOf(t)>-1)?nt:at))},wheel:function(e){var t=this,i=Number(this.options.wheelZoomRatio)||.1,a=1;this.disabled||(e.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout((function(){t.wheeling=!1}),50),e.deltaY?a=e.deltaY>0?1:-1:e.wheelDelta?a=-e.wheelDelta/120:e.detail&&(a=e.detail>0?1:-1),this.zoom(-a*i,e)))},cropStart:function(e){var t=e.buttons,i=e.button;if(!(this.disabled||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(Nt(t)&&1!==t||Nt(i)&&0!==i||e.ctrlKey))){var a,n=this.options,o=this.pointers;e.changedTouches?Wt(e.changedTouches,(function(e){o[e.identifier]=ni(e)})):o[e.pointerId||0]=ni(e),a=Object.keys(o).length>1&&n.zoomable&&n.zoomOnTouch?Ie:Xt(e.target,tt),bt.test(a)&&!1!==Qt(this.element,ct,{originalEvent:e,action:a})&&(e.preventDefault(),this.action=a,this.cropping=!1,a===Pe&&(this.cropping=!0,Rt(this.dragBox,Je)))}},cropMove:function(e){var t=this.action;if(!this.disabled&&t){var i=this.pointers;e.preventDefault(),!1!==Qt(this.element,lt,{originalEvent:e,action:t})&&(e.changedTouches?Wt(e.changedTouches,(function(e){Lt(i[e.identifier]||{},ni(e,!0))})):Lt(i[e.pointerId||0]||{},ni(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var t=this.action,i=this.pointers;e.changedTouches?Wt(e.changedTouches,(function(e){delete i[e.identifier]})):delete i[e.pointerId||0],t&&(e.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,$t(this.dragBox,Je,this.cropped&&this.options.modal)),Qt(this.element,st,{originalEvent:e,action:t}))}}},fi={change:function(e){var t,i=this.options,a=this.canvasData,n=this.containerData,o=this.cropBoxData,r=this.pointers,s=this.action,l=i.aspectRatio,c=o.left,h=o.top,d=o.width,p=o.height,u=c+d,f=h+p,m=0,g=0,v=n.width,y=n.height,b=!0;!l&&e.shiftKey&&(l=d&&p?d/p:1),this.limited&&(m=o.minLeft,g=o.minTop,v=m+Math.min(n.width,a.width,a.left+a.width),y=g+Math.min(n.height,a.height,a.top+a.height));var w=r[Object.keys(r)[0]],k={x:w.endX-w.startX,y:w.endY-w.startY},C=function(e){switch(e){case Re:u+k.x>v&&(k.x=v-u);break;case Ae:c+k.x<m&&(k.x=m-c);break;case ze:h+k.y<g&&(k.y=g-h);break;case $e:f+k.y>y&&(k.y=y-f)}};switch(s){case Te:c+=k.x,h+=k.y;break;case Re:if(k.x>=0&&(u>=v||l&&(h<=g||f>=y))){b=!1;break}C(Re),(d+=k.x)<0&&(s=Ae,c-=d=-d),l&&(p=d/l,h+=(o.height-p)/2);break;case ze:if(k.y<=0&&(h<=g||l&&(c<=m||u>=v))){b=!1;break}C(ze),p-=k.y,h+=k.y,p<0&&(s=$e,h-=p=-p),l&&(d=p*l,c+=(o.width-d)/2);break;case Ae:if(k.x<=0&&(c<=m||l&&(h<=g||f>=y))){b=!1;break}C(Ae),d-=k.x,c+=k.x,d<0&&(s=Re,c-=d=-d),l&&(p=d/l,h+=(o.height-p)/2);break;case $e:if(k.y>=0&&(f>=y||l&&(c<=m||u>=v))){b=!1;break}C($e),(p+=k.y)<0&&(s=ze,h-=p=-p),l&&(d=p*l,c+=(o.width-d)/2);break;case je:if(l){if(k.y<=0&&(h<=g||u>=v)){b=!1;break}C(ze),p-=k.y,h+=k.y,d=p*l}else C(ze),C(Re),k.x>=0?u<v?d+=k.x:k.y<=0&&h<=g&&(b=!1):d+=k.x,k.y<=0?h>g&&(p-=k.y,h+=k.y):(p-=k.y,h+=k.y);d<0&&p<0?(s=Ue,h-=p=-p,c-=d=-d):d<0?(s=Xe,c-=d=-d):p<0&&(s=Ye,h-=p=-p);break;case Xe:if(l){if(k.y<=0&&(h<=g||c<=m)){b=!1;break}C(ze),p-=k.y,h+=k.y,d=p*l,c+=o.width-d}else C(ze),C(Ae),k.x<=0?c>m?(d-=k.x,c+=k.x):k.y<=0&&h<=g&&(b=!1):(d-=k.x,c+=k.x),k.y<=0?h>g&&(p-=k.y,h+=k.y):(p-=k.y,h+=k.y);d<0&&p<0?(s=Ye,h-=p=-p,c-=d=-d):d<0?(s=je,c-=d=-d):p<0&&(s=Ue,h-=p=-p);break;case Ue:if(l){if(k.x<=0&&(c<=m||f>=y)){b=!1;break}C(Ae),d-=k.x,c+=k.x,p=d/l}else C($e),C(Ae),k.x<=0?c>m?(d-=k.x,c+=k.x):k.y>=0&&f>=y&&(b=!1):(d-=k.x,c+=k.x),k.y>=0?f<y&&(p+=k.y):p+=k.y;d<0&&p<0?(s=je,h-=p=-p,c-=d=-d):d<0?(s=Ye,c-=d=-d):p<0&&(s=Xe,h-=p=-p);break;case Ye:if(l){if(k.x>=0&&(u>=v||f>=y)){b=!1;break}C(Re),p=(d+=k.x)/l}else C($e),C(Re),k.x>=0?u<v?d+=k.x:k.y>=0&&f>=y&&(b=!1):d+=k.x,k.y>=0?f<y&&(p+=k.y):p+=k.y;d<0&&p<0?(s=Xe,h-=p=-p,c-=d=-d):d<0?(s=Ue,c-=d=-d):p<0&&(s=je,h-=p=-p);break;case _e:this.move(k.x,k.y),b=!1;break;case Ie:this.zoom(function(e){var t=Ve({},e),i=0;return Wt(e,(function(e,a){delete t[a],Wt(t,(function(t){var a=Math.abs(e.startX-t.startX),n=Math.abs(e.startY-t.startY),o=Math.abs(e.endX-t.endX),r=Math.abs(e.endY-t.endY),s=Math.sqrt(a*a+n*n),l=(Math.sqrt(o*o+r*r)-s)/s;Math.abs(l)>Math.abs(i)&&(i=l)}))})),i}(r),e),b=!1;break;case Pe:if(!k.x||!k.y){b=!1;break}t=Zt(this.cropper),c=w.startX-t.left,h=w.startY-t.top,d=o.minWidth,p=o.minHeight,k.x>0?s=k.y>0?Ye:je:k.x<0&&(c-=d,s=k.y>0?Ue:Xe),k.y<0&&(h-=p),this.cropped||(At(this.cropBox,Ke),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}b&&(o.width=d,o.height=p,o.left=c,o.top=h,this.action=s,this.renderCropBox()),Wt(r,(function(e){e.startX=e.endX,e.startY=e.endY}))}},mi={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&Rt(this.dragBox,Je),At(this.cropBox,Ke),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=Lt({},this.initialImageData),this.canvasData=Lt({},this.initialCanvasData),this.cropBoxData=Lt({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(Lt(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),At(this.dragBox,Je),Rt(this.cropBox,Ke)),this},replace:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&e&&(this.isImg&&(this.element.src=e),t?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,Wt(this.previews,(function(t){t.getElementsByTagName("img")[0].src=e})))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,At(this.cropper,Ge)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,Rt(this.cropper,Ge)),this},destroy:function(){var e=this.element;return e.cropper?(e.cropper=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,a=i.left,n=i.top;return this.moveTo(Bt(e)?e:a+Number(e),Bt(t)?t:n+Number(t))},moveTo:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.canvasData,a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.movable&&(Nt(e)&&(i.left=e,a=!0),Nt(t)&&(i.top=t,a=!0),a&&this.renderCanvas(!0)),this},zoom:function(e,t){var i=this.canvasData;return e=(e=Number(e))<0?1/(1-e):1+e,this.zoomTo(i.width*e/i.naturalWidth,null,t)},zoomTo:function(e,t,i){var a=this.options,n=this.canvasData,o=n.width,r=n.height,s=n.naturalWidth,l=n.naturalHeight;if((e=Number(e))>=0&&this.ready&&!this.disabled&&a.zoomable){var c=s*e,h=l*e;if(!1===Qt(this.element,vt,{ratio:e,oldRatio:o/s,originalEvent:i}))return this;if(i){var d=this.pointers,p=Zt(this.cropper),u=d&&Object.keys(d).length?function(e){var t=0,i=0,a=0;return Wt(e,(function(e){var n=e.startX,o=e.startY;t+=n,i+=o,a+=1})),{pageX:t/=a,pageY:i/=a}}(d):{pageX:i.pageX,pageY:i.pageY};n.left-=(c-o)*((u.pageX-p.left-n.left)/o),n.top-=(h-r)*((u.pageY-p.top-n.top)/r)}else St(t)&&Nt(t.x)&&Nt(t.y)?(n.left-=(c-o)*((t.x-n.left)/o),n.top-=(h-r)*((t.y-n.top)/r)):(n.left-=(c-o)/2,n.top-=(h-r)/2);n.width=c,n.height=h,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return Nt(e=Number(e))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var t=this.imageData.scaleY;return this.scale(e,Nt(t)?t:1)},scaleY:function(e){var t=this.imageData.scaleX;return this.scale(Nt(t)?t:1,e)},scale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.imageData,a=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.scalable&&(Nt(e)&&(i.scaleX=e,a=!0),Nt(t)&&(i.scaleY=t,a=!0),a&&this.renderCanvas(!0,!0)),this},getData:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.options,a=this.imageData,n=this.canvasData,o=this.cropBoxData;if(this.ready&&this.cropped){e={x:o.left-n.left,y:o.top-n.top,width:o.width,height:o.height};var r=a.width/a.naturalWidth;if(Wt(e,(function(t,i){e[i]=t/r})),t){var s=Math.round(e.y+e.height),l=Math.round(e.x+e.width);e.x=Math.round(e.x),e.y=Math.round(e.y),e.width=l-e.x,e.height=s-e.y}}else e={x:0,y:0,width:0,height:0};return i.rotatable&&(e.rotate=a.rotate||0),i.scalable&&(e.scaleX=a.scaleX||1,e.scaleY=a.scaleY||1),e},setData:function(e){var t=this.options,i=this.imageData,a=this.canvasData,n={};if(this.ready&&!this.disabled&&St(e)){var o=!1;t.rotatable&&Nt(e.rotate)&&e.rotate!==i.rotate&&(i.rotate=e.rotate,o=!0),t.scalable&&(Nt(e.scaleX)&&e.scaleX!==i.scaleX&&(i.scaleX=e.scaleX,o=!0),Nt(e.scaleY)&&e.scaleY!==i.scaleY&&(i.scaleY=e.scaleY,o=!0)),o&&this.renderCanvas(!0,!0);var r=i.width/i.naturalWidth;Nt(e.x)&&(n.left=e.x*r+a.left),Nt(e.y)&&(n.top=e.y*r+a.top),Nt(e.width)&&(n.width=e.width*r),Nt(e.height)&&(n.height=e.height*r),this.setCropBoxData(n)}return this},getContainerData:function(){return this.ready?Lt({},this.containerData):{}},getImageData:function(){return this.sized?Lt({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,t={};return this.ready&&Wt(["left","top","width","height","naturalWidth","naturalHeight"],(function(i){t[i]=e[i]})),t},setCanvasData:function(e){var t=this.canvasData,i=t.aspectRatio;return this.ready&&!this.disabled&&St(e)&&(Nt(e.left)&&(t.left=e.left),Nt(e.top)&&(t.top=e.top),Nt(e.width)?(t.width=e.width,t.height=e.width/i):Nt(e.height)&&(t.height=e.height,t.width=e.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var e,t=this.cropBoxData;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(e){var t,i,a=this.cropBoxData,n=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&St(e)&&(Nt(e.left)&&(a.left=e.left),Nt(e.top)&&(a.top=e.top),Nt(e.width)&&e.width!==a.width&&(t=!0,a.width=e.width),Nt(e.height)&&e.height!==a.height&&(i=!0,a.height=e.height),n&&(t?a.height=a.width/n:i&&(a.width=a.height*n)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var t=this.canvasData,i=ri(this.image,this.imageData,t,e);if(!this.cropped)return i;var a=this.getData(),n=a.x,o=a.y,r=a.width,s=a.height,l=i.width/Math.floor(t.naturalWidth);1!==l&&(n*=l,o*=l,r*=l,s*=l);var c=r/s,h=oi({aspectRatio:c,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),d=oi({aspectRatio:c,width:e.minWidth||0,height:e.minHeight||0},"cover"),p=oi({aspectRatio:c,width:e.width||(1!==l?i.width:r),height:e.height||(1!==l?i.height:s)}),u=p.width,f=p.height;u=Math.min(h.width,Math.max(d.width,u)),f=Math.min(h.height,Math.max(d.height,f));var m=document.createElement("canvas"),g=m.getContext("2d");m.width=Pt(u),m.height=Pt(f),g.fillStyle=e.fillColor||"transparent",g.fillRect(0,0,u,f);var v=e.imageSmoothingEnabled,y=void 0===v||v,b=e.imageSmoothingQuality;g.imageSmoothingEnabled=y,b&&(g.imageSmoothingQuality=b);var w,k,C,x,D,N,M=i.width,B=i.height,V=n,F=o;V<=-r||V>M?(V=0,w=0,C=0,D=0):V<=0?(C=-V,V=0,D=w=Math.min(M,r+V)):V<=M&&(C=0,D=w=Math.min(r,M-V)),w<=0||F<=-s||F>B?(F=0,k=0,x=0,N=0):F<=0?(x=-F,F=0,N=k=Math.min(B,s+F)):F<=B&&(x=0,N=k=Math.min(s,B-F));var S=[V,F,w,k];if(D>0&&N>0){var E=u/r;S.push(C*E,x*E,D*E,N*E)}return g.drawImage.apply(g,[i].concat(Fe(S.map((function(e){return Math.floor(Pt(e))}))))),m},setAspectRatio:function(e){var t=this.options;return this.disabled||Bt(e)||(t.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var t=this.options,i=this.dragBox,a=this.face;if(this.ready&&!this.disabled){var n=e===at,o=t.movable&&e===nt;e=n||o?e:ot,t.dragMode=e,Yt(i,tt,e),$t(i,qe,n),$t(i,et,o),t.cropBoxMovable||(Yt(a,tt,e),$t(a,qe,n),$t(a,et,o))}return this}},gi=Oe.Cropper,vi=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(De(this,e),!t||!Ct.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=Lt({},xt,St(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}var t,i,a;return t=e,a=[{key:"noConflict",value:function(){return window.Cropper=gi,e}},{key:"setDefaults",value:function(e){Lt(xt,St(e)&&e)}}],(i=[{key:"init",value:function(){var e,t=this.element,i=t.tagName.toLowerCase();if(!t.cropper){if(t.cropper=this,"img"===i){if(this.isImg=!0,e=t.getAttribute("src")||"",this.originalUrl=e,!e)return;e=t.src}else"canvas"===i&&window.HTMLCanvasElement&&(e=t.toDataURL());this.load(e)}}},{key:"load",value:function(e){var t=this;if(e){this.url=e,this.imageData={};var i=this.element,a=this.options;if(a.rotatable||a.scalable||(a.checkOrientation=!1),a.checkOrientation&&window.ArrayBuffer)if(wt.test(e))kt.test(e)?this.read((n=e.replace(li,""),o=atob(n),r=new ArrayBuffer(o.length),Wt(s=new Uint8Array(r),(function(e,t){s[t]=o.charCodeAt(t)})),r)):this.clone();else{var n,o,r,s,l=new XMLHttpRequest,c=this.clone.bind(this);this.reloading=!0,this.xhr=l,l.onabort=c,l.onerror=c,l.ontimeout=c,l.onprogress=function(){l.getResponseHeader("content-type")!==yt&&l.abort()},l.onload=function(){t.read(l.response)},l.onloadend=function(){t.reloading=!1,t.xhr=null},a.checkCrossOrigin&&ti(e)&&i.crossOrigin&&(e=ii(e)),l.open("GET",e,!0),l.responseType="arraybuffer",l.withCredentials="use-credentials"===i.crossOrigin,l.send()}else this.clone()}}},{key:"read",value:function(e){var t=this.options,i=this.imageData,a=ci(e),n=0,o=1,r=1;if(a>1){this.url=function(e,t){for(var i=[],a=new Uint8Array(e);a.length>0;)i.push(si.apply(null,Ht(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}(e,yt);var s=function(e){var t=0,i=1,a=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90}return{rotate:t,scaleX:i,scaleY:a}}(a);n=s.rotate,o=s.scaleX,r=s.scaleY}t.rotatable&&(i.rotate=n),t.scalable&&(i.scaleX=o,i.scaleY=r),this.clone()}},{key:"clone",value:function(){var e=this.element,t=this.url,i=e.crossOrigin,a=t;this.options.checkCrossOrigin&&ti(t)&&(i||(i="anonymous"),a=ii(t)),this.crossOrigin=i,this.crossOriginUrl=a;var n=document.createElement("img");i&&(n.crossOrigin=i),n.src=a||t,n.alt=e.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),Rt(n,Qe),e.parentNode.insertBefore(n,e.nextSibling)}},{key:"start",value:function(){var e=this,t=this.image;t.onload=null,t.onerror=null,this.sizing=!0;var i=Oe.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(Oe.navigator.userAgent),a=function(t,i){Lt(e.imageData,{naturalWidth:t,naturalHeight:i,aspectRatio:t/i}),e.initialImageData=Lt({},e.imageData),e.sizing=!1,e.sized=!0,e.build()};if(!t.naturalWidth||i){var n=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){a(n.width,n.height),i||o.removeChild(n)},n.src=t.src,i||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(n))}else a(t.naturalWidth,t.naturalHeight)}},{key:"stop",value:function(){var e=this.image;e.onload=null,e.onerror=null,e.parentNode.removeChild(e),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var e=this.element,t=this.options,i=this.image,a=e.parentNode,n=document.createElement("div");n.innerHTML='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>';var o=n.querySelector(".".concat(Le,"-container")),r=o.querySelector(".".concat(Le,"-canvas")),s=o.querySelector(".".concat(Le,"-drag-box")),l=o.querySelector(".".concat(Le,"-crop-box")),c=l.querySelector(".".concat(Le,"-face"));this.container=a,this.cropper=o,this.canvas=r,this.dragBox=s,this.cropBox=l,this.viewBox=o.querySelector(".".concat(Le,"-view-box")),this.face=c,r.appendChild(i),Rt(e,Ke),a.insertBefore(o,e.nextSibling),this.isImg||At(i,Qe),this.initPreview(),this.bind(),t.initialAspectRatio=Math.max(0,t.initialAspectRatio)||NaN,t.aspectRatio=Math.max(0,t.aspectRatio)||NaN,t.viewMode=Math.max(0,Math.min(3,Math.round(t.viewMode)))||0,Rt(l,Ke),t.guides||Rt(l.getElementsByClassName("".concat(Le,"-dashed")),Ke),t.center||Rt(l.getElementsByClassName("".concat(Le,"-center")),Ke),t.background&&Rt(o,"".concat(Le,"-bg")),t.highlight||Rt(c,Ze),t.cropBoxMovable&&(Rt(c,et),Yt(c,tt,Te)),t.cropBoxResizable||(Rt(l.getElementsByClassName("".concat(Le,"-line")),Ke),Rt(l.getElementsByClassName("".concat(Le,"-point")),Ke)),this.render(),this.ready=!0,this.setDragMode(t.dragMode),t.autoCrop&&this.crop(),this.setData(t.data),Et(t.ready)&&Kt(e,ft,t.ready,{once:!0}),Qt(e,ft)}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),At(this.element,Ke))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}])&&Ne(t.prototype,i),a&&Ne(t,a),e}();Lt(vi.prototype,hi,di,pi,ui,fi,mi);let yi=null,bi={autoCrop:!1,toggleDragModeOnDblclick:!0,dragMode:"crop",viewMode:1,checkOrientation:!0,rotatable:!0};const wi={props:["file"],data:()=>({dragMode:bi.dragMode,ratio:"",isValidRatio:!0,naturalWidth:0,naturalHeight:0,cropWidth:0,cropHeight:0,finalWidth:0,finalWidthLocked:!1,finalHeight:0,finalHeightLocked:!1}),computed:__assign({},i.mapState(["fileValidation"])),watch:{finalWidth(e){}},methods:__assign(__assign(__assign({updateRatio(e){let t,i,a=e.target.value;if(this.ratio=a,!a)return this.isValidRatio=!0,void yi.setAspectRatio(NaN);let n=a.split(":"),o=a.split("/"),r=parseFloat(a);2===n.length?(t=parseInt(n[0]),i=parseInt(n[1]),console.log("ah",t,i,t/i,isNaN(t/i)),r=t/i):2===o.length&&(t=parseInt(o[0]),i=parseInt(o[1]),r=t/i),isNaN(r)?this.isValidRatio=!1:(this.isValidRatio=!0,yi.setAspectRatio(r))},handleLock(e){"height"===e?(this.finalHeightLocked=!this.finalHeightLocked,this.finalHeightLocked&&(this.finalWidthLocked=!1)):(this.finalWidthLocked=!this.finalWidthLocked,this.finalWidthLocked&&(this.finalHeightLocked=!1))},userChangeFinalWidth(e){this.finalWidthLocked=!0,this.finalHeightLocked=!1,this.finalHeight=Math.round(this.finalWidth*this.cropHeight/this.cropWidth)},userChangeFinalHeight(e){this.finalWidthLocked=!1,this.finalHeightLocked=!0,this.finalWidth=Math.round(this.finalHeight*this.cropWidth/this.cropHeight)}},i.mapMutations(["setEditContent"])),i.mapActions(["cropFile"])),{handleReturn(){this.destroyCropper(),this.setEditContent(null)},handleClear(){yi.clear(),yi.reset(),this.cropWidth=this.naturalWidth,this.cropHeight=this.naturalHeight,this.finalWidthLocked||this.finalHeightLocked?this.finalWidthLocked?this.finalHeight=Math.round(this.finalWidth*this.cropHeight/this.cropWidth):this.finalHeightLocked&&(this.finalWidth=Math.round(this.finalHeight*this.cropWidth/this.cropHeight)):(this.finalWidth=this.naturalWidth,this.finalHeight=this.naturalHeight)},changeMode(e){yi&&("none"===e&&this.handleClear(),this.dragMode=e,yi.setDragMode(e))},rotate(e){yi&&yi.rotate(e)},handleCrop({detail:e}){let t=Math.round(e.width),i=Math.round(e.height);if(0===t||0===i)return this.cropWidth=0,this.cropHeight=0,this.finalWidthLocked||(this.finalWidth=0),void(this.finalHeightLocked||(this.finalHeight=0));this.cropWidth=t,this.cropHeight=i,this.finalWidthLocked||this.finalHeightLocked?this.finalWidthLocked?this.finalHeight=Math.round(this.finalWidth*e.height/e.width):this.finalHeightLocked&&(this.finalWidth=Math.round(this.finalHeight*e.width/e.height)):(this.finalWidth=t,this.finalHeight=i)},handleCropEnd(e){},async handleSave(){let e=yi.getData();await this.cropFile({file:this.file,dimensions:e,finalWidth:this.finalWidth,finalHeight:this.finalHeight}),console.log("handleSave",e),this.destroyCropper(),await this.initCropper()},initCropper(){this.$refs.imageElt.addEventListener("crop",this.handleCrop),this.$refs.imageElt.addEventListener("cropend",this.handleCropEnd),this.$refs.imageElt.addEventListener("ready",this.isReady),yi=new vi(this.$refs.imageElt,bi)},isReady(){let e=yi.getImageData();this.naturalWidth=e.naturalWidth,this.naturalHeight=e.naturalHeight,this.cropWidth=e.naturalWidth,this.cropHeight=e.naturalHeight,this.finalWidth=e.naturalWidth,this.finalHeight=e.naturalHeight},destroyCropper(){yi&&yi.destroy(),this.naturalWidth=0,this.naturalHeight=0,this.cropWidth=0,this.cropHeight=0,this.finalWidth=0,this.finalHeight=0,yi=null,this.$refs.imageElt.removeEventListener("crop",this.handleCrop),this.$refs.imageElt.removeEventListener("cropend",this.handleCropEnd),this.$refs.imageElt.removeEventListener("ready",this.isReady)},async onImageLoad(){await t.nextTick(),this.initCropper()},unmounted(){this.destroyCropper()}})},ki={key:0,class:"image-editor"},Ci={class:"header"},xi={class:"btn-group"},Di=t.createVNode("i",{class:"fa-move"},null,-1),Ni=t.createVNode("i",{class:"fa-crop"},null,-1),Mi={class:"btn-group"},Bi=t.createVNode("i",{class:"fa-ccw"},null,-1),Vi=t.createVNode("i",{class:"fa-cw"},null,-1),Fi=t.createVNode("i",{class:"fa-cancel"},null,-1),Si=t.createVNode("i",{class:"fa-ok"},null,-1),Ei={class:"content"},Oi={class:"abs-content"},Hi={class:"footer"},Wi=t.createVNode("i",{class:"fa-picture"},null,-1),Li=t.createVNode("i",{class:"fa-right-open"},null,-1),Ti=t.createVNode("i",{class:"fa-ratio"},null,-1),Pi=t.createVNode("i",{class:"fa-right-open"},null,-1),_i=t.createVNode("i",{class:"fa-crop"},null,-1),Ii=t.createVNode("i",{class:"fa-right-open"},null,-1),Ri=t.createVNode("i",{class:"fa-resize-horizontal"},null,-1),Ai=t.createTextVNode(", "),$i=t.createVNode("i",{class:"fa-right-open"},null,-1),zi=t.createVNode("i",{class:"fa-resize-vertical"},null,-1),ji=t.createTextVNode(" px ");wi.render=function(e,i,a,n,o,r){return a.file?(t.openBlock(),t.createBlock("div",ki,[t.createVNode("div",Ci,[t.createVNode("button",{class:"btn outlined back",onClick:i[1]||(i[1]=(...e)=>r.handleReturn&&r.handleReturn(...e))},"Retour"),t.createVNode("div",xi,[t.createVNode("button",{class:["btn outlined",{active:"move"===o.dragMode}],onClick:i[2]||(i[2]=e=>r.changeMode("move"))},[Di],2),t.createVNode("button",{class:["btn outlined",{active:"crop"===o.dragMode}],onClick:i[3]||(i[3]=e=>r.changeMode("crop"))},[Ni],2)]),t.createVNode("div",Mi,[t.createVNode("button",{class:"btn outlined",onClick:i[4]||(i[4]=e=>r.rotate(-90))},[Bi]),t.createVNode("button",{class:"btn outlined",onClick:i[5]||(i[5]=e=>r.rotate(90))},[Vi])]),t.createVNode("button",{class:"btn outlined",onClick:i[6]||(i[6]=(...e)=>r.handleClear&&r.handleClear(...e))},[Fi]),t.createVNode("button",{class:"btn",onClick:i[7]||(i[7]=(...e)=>r.handleSave&&r.handleSave(...e))},[Si])]),t.createVNode("div",Ei,[t.createVNode("div",Oi,[t.createVNode("img",{class:"original",ref:"imageElt",crossorigin:"",src:a.file.url,onLoad:i[8]||(i[8]=(...e)=>r.onImageLoad&&r.onImageLoad(...e))},null,40,["src"])])]),t.createVNode("div",Hi,[Wi,t.createVNode("span",null,t.toDisplayString(o.naturalWidth)+", "+t.toDisplayString(o.naturalHeight)+" px",1),Li,Ti,t.createVNode("input",{type:"text",class:["ratio form-input",{"is-invalid":!o.isValidRatio}],value:o.ratio,onInput:i[9]||(i[9]=(...e)=>r.updateRatio&&r.updateRatio(...e)),placeholder:"ex: 16:9"},null,42,["value"]),Pi,_i,t.createVNode("span",null,t.toDisplayString(o.cropWidth)+", "+t.toDisplayString(o.cropHeight)+" px",1),Ii,Ri,t.withDirectives(t.createVNode("input",{type:"text","onUpdate:modelValue":i[10]||(i[10]=e=>o.finalWidth=e),class:"nb form-input",disabled:o.finalHeightLocked,onInput:i[11]||(i[11]=(...e)=>r.userChangeFinalWidth&&r.userChangeFinalWidth(...e))},null,40,["disabled"]),[[t.vModelText,o.finalWidth]]),t.createVNode("span",{class:"lock",onClick:i[12]||(i[12]=e=>r.handleLock("width"))},[t.createVNode("i",{class:{"fa-lock":o.finalWidthLocked,"fa-lock-open":!o.finalWidthLocked}},null,2)]),Ai,$i,zi,t.withDirectives(t.createVNode("input",{type:"text","onUpdate:modelValue":i[13]||(i[13]=e=>o.finalHeight=e),class:"nb form-input",disabled:o.finalWidthLocked,onInput:i[14]||(i[14]=(...e)=>r.userChangeFinalHeight&&r.userChangeFinalHeight(...e))},null,40,["disabled"]),[[t.vModelText,o.finalHeight]]),t.createVNode("span",{class:"lock",onClick:i[15]||(i[15]=e=>r.handleLock("height"))},[t.createVNode("i",{class:{"fa-lock":o.finalHeightLocked,"fa-lock-open":!o.finalHeightLocked}},null,2)]),ji])])):t.createCommentVNode("",!0)};const Xi={components:{Uploader:r,Infos:g,VSelect:re,Icon:ye,ListItem:pe,ImageEditor:wi},props:{isModal:{type:Boolean,default:!1}},data:()=>({presentation:"icons",options:{}}),computed:__assign(__assign(__assign({},i.mapState(["editing","files","entryPoints","secondaryDirectories","currentEntryPoint","isAdmin","selectedFiles","editContent"])),i.mapGetters(["sortedFiles"])),{canEdit(){return!!this.isAdmin||this.currentEntryPoint&&!this.currentEntryPoint.readOnly},currentEntryPoint:{get(){return this.$store.state.currentEntryPoint},set(e){this.$store.dispatch("setCurrentEntryPoint",e)}},fileComponent(){return"list"===this.presentation?pe:ye},presentationClass(){return`${this.presentation}-presentation`}}),methods:__assign(__assign(__assign({},i.mapMutations(["selectFile","unselectFiles","addFileToSelection","removeFileToSelection"])),i.mapActions(["init","setCurrentEntryPoint","download","deleteSelectedFiles","setSecondaryDirectoryFromFullDirectory","addDirectory"])),{toggleOrder(){this.presentation="list"===this.presentation?"icons":"list"},noDragging(e){e.dataTransfer.dropEffect="none"},isSelected(e){return this.selectedFiles.includes(e)},handleKeyPressed(e){46===e.keyCode&&this.selectedFiles.length>0&&!this.editing&&this.deleteSelectedFiles()},handleAddDirectory(){let e=this;a.prompt("Nom du dossier",{okHandler:function(t){t.length>128?a.notify("Le nom du dossier est trop long.",{style:"error"}):e.addDirectory(t)}})},handleClick(e,t){if(t&&2===t.detail)return;-1===this.selectedFiles.indexOf(e)&&this.addFileToSelection(e)},handleDblClick(e){switch(e.type){case"file":this.isModal?this.$emit("confirm"):this.download({files:[e]});break;case"dir":this.setSecondaryDirectoryFromFullDirectory(e.uploadRelativePath)}},handleChangeSecondaryDirectory(e){let t=[];for(let a=0;a<e;a++)t.push(this.secondaryDirectories[a]);let i=t.join("/");""!==i&&(i="/"+i),this.setSecondaryDirectoryFromFullDirectory(this.currentEntryPoint.directory+i)}}),mounted(){this.init(),window.addEventListener("keydown",this.handleKeyPressed)},unmounted(){window.removeEventListener("keydown",this.handleKeyPressed)}},Yi=t.withScopeId("data-v-7f2cd26f");t.pushScopeId("data-v-7f2cd26f");const Ui={class:"action"},qi={key:0,class:"fa-order-list"},Gi={key:1,class:"fa-order-icons"},Ki=t.createVNode("i",{class:"fa-folder-add"},null,-1),Qi={class:"hierarchy"},Zi={class:"files"};t.popScopeId();const Ji=Yi(((e,i,a,n,o,r)=>{const s=t.resolveComponent("ImageEditor"),l=t.resolveComponent("Uploader"),c=t.resolveComponent("VSelect"),h=t.resolveComponent("Infos");return e.editContent?(t.openBlock(),t.createBlock(s,{key:0,class:"image-editor",file:e.editContent},null,8,["file"])):(t.openBlock(),t.createBlock("div",{key:1,class:"file-manager",onDragover:i[6]||(i[6]=(...e)=>r.noDragging&&r.noDragging(...e))},[t.createVNode("div",Ui,[t.createVNode("button",{class:"btn btn-outlined",onClick:i[1]||(i[1]=t.withModifiers((e=>r.toggleOrder()),["prevent"]))},["list"===o.presentation?(t.openBlock(),t.createBlock("i",qi)):t.createCommentVNode("",!0),"icons"===o.presentation?(t.openBlock(),t.createBlock("i",Gi)):t.createCommentVNode("",!0)]),t.createVNode("button",{class:"btn btn-outlined",disabled:!r.canEdit,onClick:i[2]||(i[2]=(...e)=>r.handleAddDirectory&&r.handleAddDirectory(...e))},[Ki],8,["disabled"])]),t.createVNode(l,{class:"dropzone"}),t.createVNode("div",Qi,[t.createVNode(c,{class:"directory-selector","split-button":!0,options:e.entryPoints,modelValue:r.currentEntryPoint,"onUpdate:modelValue":i[3]||(i[3]=e=>r.currentEntryPoint=e),onClick:i[4]||(i[4]=e=>r.handleChangeSecondaryDirectory(0)),placeholder:"Répertoire"},null,8,["options","modelValue"]),(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.secondaryDirectories,((e,i)=>(t.openBlock(),t.createBlock("button",{class:"btn btn-outlined",onClick:e=>r.handleChangeSecondaryDirectory(i+1),key:i},t.toDisplayString(e),9,["onClick"])))),128))]),t.createVNode("div",{class:["files-container",{[r.presentationClass]:!0}],onClick:i[5]||(i[5]=(...t)=>e.unselectFiles&&e.unselectFiles(...t))},[t.createVNode("div",Zi,[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(e.sortedFiles,(e=>(t.openBlock(),t.createBlock(t.resolveDynamicComponent(r.fileComponent),{key:e.id,class:["file",{selected:r.isSelected(e)}],file:e,onClick:t.withModifiers((t=>r.handleClick(e,t)),["stop"]),onDblclick:t.withModifiers((t=>r.handleDblClick(e)),["stop"])},null,8,["file","class","onClick","onDblclick"])))),128))])],2),t.createVNode(h,{class:"infos",files:e.selectedFiles},null,8,["files"])],32))}));Xi.render=Ji,Xi.__scopeId="data-v-7f2cd26f";const ea={components:{FileManager:Xi,ImageEditor:wi},computed:__assign(__assign({},i.mapState(["selectedFiles","fileValidation","editContent"])),i.mapGetters(["invalidSelectedFiles"])),methods:__assign(__assign({},i.mapMutations(["setEditContent"])),{goImageEditor(){this.setEditContent(this.invalidSelectedFiles[0])},handleAbort(){let e=new CustomEvent("abortSelect");this.$el.dispatchEvent(e)},handleConfirm(){if(this.invalidSelectedFiles.length>0)return void console.error("il y a des règles de validation non satisfaites");let e=new CustomEvent("selectFiles",{detail:this.selectedFiles});this.$el.dispatchEvent(e)}})},ta=t.withScopeId("data-v-f6720a4e");t.pushScopeId("data-v-f6720a4e");const ia={class:"file-manager-modal"},aa={class:"box"},na={class:"actions"},oa=t.createVNode("div",{class:"sep"},null,-1),ra=t.createVNode("i",{class:"fa-picture"},null,-1),sa=t.createTextVNode(" Éditer ");t.popScopeId();const la=ta(((e,i,a,n,o,r)=>{const s=t.resolveComponent("FileManager"),l=t.resolveDirective("body-scroll-lock");return t.openBlock(),t.createBlock("div",ia,[t.createVNode("div",aa,[t.withDirectives(t.createVNode(s,{class:"main-content","is-modal":!0,onConfirm:r.handleConfirm},null,8,["onConfirm"]),[[l,!0,"reserve-scroll-bar-gap"]]),t.createVNode("div",na,[e.editContent?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock("button",{key:0,class:"btn outlined abort",onClick:i[1]||(i[1]=(...e)=>r.handleAbort&&r.handleAbort(...e))}," Annuler ")),oa,!e.editContent&&e.invalidSelectedFiles.length>0?(t.openBlock(),t.createBlock("button",{key:1,class:"btn",onClick:i[2]||(i[2]=(...e)=>r.goImageEditor&&r.goImageEditor(...e))},[ra,sa])):t.createCommentVNode("",!0),t.createVNode("button",{disabled:e.invalidSelectedFiles.length>0||0===e.selectedFiles.length,class:"btn",onClick:i[3]||(i[3]=(...e)=>r.handleConfirm&&r.handleConfirm(...e))}," Sélectionner ",8,["disabled"])])]),t.createVNode("div",{class:"bg",onClick:i[4]||(i[4]=(...e)=>r.handleAbort&&r.handleAbort(...e))})])}));ea.render=la,ea.__scopeId="data-v-f6720a4e";const ca="reserve-scroll-bar-gap",ha={reserveScrollBarGap:!0},da={mounted:(e,t)=>{t.arg&&t.arg===ca&&t.value?n.disableBodyScroll(e,ha):t.value&&n.disableBodyScroll(e)},updated:(e,t)=>{t.oldValue!==t.value&&(t.arg&&t.arg===ca&&t.value?n.disableBodyScroll(e,ha):t.value?n.disableBodyScroll(e):n.enableBodyScroll(e))},unmounted:e=>{n.enableBodyScroll(e)}},{jsonFetchOrNotify:pa,formFetchOrNotify:ua,fetchOrNotify:fa}=o.apiHelper;function ma({entryPoints:e,isAdmin:t,endPoint:a,fileValidation:n,originalSelection:r}){r=function(e,t){if(!e)return null;let i,a,n,o,r,s,l,c=[];for(let h of e)"@"!==h[0]?(a=t[0].origin,n=h,l=`@${a}:${n}`):(l=h,i=h.substr(1),o=i.indexOf(":"),a=i.substr(0,o),n=i.substr(o+1)),r=n.lastIndexOf("/"),-1===r?s="":(s=n.substr(0,r),n=n.substr(r+1)),c.push([a,s,n,l]);return c}(r,e);let s="?XDEBUG_TRIGGER";return i.createStore({state:{endPoints:{deleteFile:`${a}/delete${s}`,downloadArchive:`${a}/download-archive${s}`,getFileContent:`${a}/get-file-content`,editFile:`${a}/edit${s}`,getFiles:`${a}/get-files${s}`,uploadFile:`${a}/upload${s}`,addDirectory:`${a}/add-directory${s}`,cropFile:`${a}/crop${s}`},isAdmin:t,entryPoints:e,fileValidation:n,currentEntryPoint:null,secondaryDirectories:[],multiple:!1,directory:null,files:[],selectedFiles:[],editing:!1,editContent:null,sortBy:"filename"},getters:{sortedFiles:e=>e.files.sort(((t,i)=>t[e.sortBy]>i[e.sortBy])),completeDirectory(e){let t="",i="";return e.currentEntryPoint?(e.secondaryDirectories.length>0&&(t=e.secondaryDirectories.join("/")),""!==e.currentEntryPoint.directory&&(i=e.currentEntryPoint.directory+"/"),i+t):null},invalidSelectedFiles:e=>e.selectedFiles.filter((e=>!function(e,t){return t.type===e.mimeGroup&&("image"!==t.type||!e.details||Math.round(1e5*t.ratio)===Math.round(1e5*e.details.ratio))}(e,n)))},mutations:{setFiles(e,t){e.files=t},replaceFile(e,{file:t,newFile:i}){let a=e.files.indexOf(t);-1===a&&console.log("impossible de trouver le fichier",t),e.files.splice(a,1,i)},removeFile(e,t){let i=e.files.indexOf(t);-1===i&&console.log("impossible de trouver le fichier",t),e.files.splice(i,1)},setDirectory(e,t){e.directory=t},setEntryPoints(e,t){e.entryPoints=t},addFile(e,t){e.files.splice(0,0,t)},addFileByIdToSelection(e,t){let i=e.files.find((e=>e.id===t));i&&(e.multiple?e.selectedFiles.push(i):e.selectedFiles=[i])},addFileToSelection(e,t){e.multiple?e.selectedFiles.push(t):e.selectedFiles=[t]},removeFileToSelection(e,t){let i=e.selectedFiles.indexOf(t);e.selectedFiles.splice(i,1)},clearSelection(e){e.selectedFiles=[]},selectFileByInode(e,t){let i=e.files.find((e=>e.inode===t));i&&(e.selectedFiles=[i])},unselectFiles(e){e.selectedFiles=[]},setEditing(e,t){e.editing=t},setEditContent(e,t=null){e.editContent=t},setCurrentEntryPoint(e,t){e.currentEntryPoint=t},setSecondaryDirectory(e,t){e.secondaryDirectories=t}},actions:{async addDirectory({state:e,getters:t,dispatch:i,commit:a},n){let{directory:o}=await ua(e.endPoints.addDirectory,{body:{filename:n,directory:t.completeDirectory,origin:e.currentEntryPoint.origin}});a("addFile",o)},async cropFile({commit:e,state:t},{file:i,dimensions:a,finalWidth:n,finalHeight:o}){let{uploadRelativePath:r,origin:s}=i,{x:l,y:c,width:h,height:d,rotate:p}=a,{file:u}=await ua(t.endPoints.cropFile,{body:{uploadRelativePath:r,origin:s,x:l,y:c,width:h,height:d,finalWidth:n,finalHeight:o,rotate:p}});return e("removeFileToSelection",i),e("replaceFile",{file:i,newFile:u}),e("addFileToSelection",u),e("setEditContent",u),u},async updateFilename({commit:e,state:t,dispatch:i},{file:a,newFilename:n}){console.log("before",a);let{origin:o,uploadRelativePath:r,directory:s,filename:l}=a,{file:c}=await ua(t.endPoints.editFile,{body:{origin:o,uploadRelativePath:r,directory:s,filename:l,readOnly:t.currentEntryPoint.readOnly,newFilename:n}});console.log("after",c),e("unselectFiles"),e("replaceFile",{file:a,newFile:c}),e("selectFileByInode",c.inode)},async download({state:e,getters:t},{files:i=[]}){if(1===i.length&&!i[0].isDir){let t=i[0];return void fa(`${e.endPoints.getFileContent}/download/${t.origin}/${t.uploadRelativePath}`).then((e=>e.blob())).then((e=>o.downloadHelper.downloadFromBlob(e,t.filename)))}let a=e.directory.filename+"-"+o.dateHelper.toIsoString(new Date)+".zip";ua(e.endPoints.downloadArchive,{body:{files:i.map((e=>e.id))}}).then((e=>e.blob())).then((e=>{o.downloadHelper.downloadFromBlob(e,a)}))},async deleteSelectedFiles({commit:e,dispatch:t,state:i}){ua(i.endPoints.deleteFile,{body:{files:i.selectedFiles.map((e=>e.id))}}).catch((()=>{t("getFiles")}));let a=i.selectedFiles;e("clearSelection");for(let n of a)e("removeFile",n)},async getFiles({dispatch:e,state:t,getters:i,commit:a}){let{files:n,directory:o}=await ua(t.endPoints.getFiles,{body:{directory:i.completeDirectory,origin:t.currentEntryPoint.origin}});if(e("setFiles",n),o||console.error("no directory !"),a("setDirectory",o),r){for(let e of r){let t=n.find((t=>t.id===e[3]));t&&a("addFileToSelection",t)}r=null}},async setFiles({commit:e},t){e("unselectFiles"),e("setFiles",t)},async setCurrentEntryPoint({commit:e,dispatch:t},i){e("setCurrentEntryPoint",i);let a=i.directory;r&&(a=r[0][1]),t("setSecondaryDirectoryFromFullDirectory",a)},async setSecondaryDirectoryFromFullDirectory({state:e,commit:t,dispatch:i},a){let n=e.currentEntryPoint.directory;if(0!==a.indexOf(n))return void console.error("répertoire inconnu");let o=a.substring(n.length),r=[];""!==o&&(o=o.replace(/^\//,""),r=o.split("/")),t("setSecondaryDirectory",r),i("getFiles")},async init({dispatch:e,state:t}){let i;r&&(i=t.entryPoints.find((e=>e.origin===r[0][0]))),e("setCurrentEntryPoint",i||t.entryPoints[0])}}})}e.createFileManager=function(e,i){"string"==typeof e&&(e=document.querySelector(e)),i||(i=JSON.parse(e.dataset.props));const a=t.createApp(Xi);return a.directive("body-scroll-lock",da),a.use(ma(i)),a.mount(e),a},e.openFileManager=function(e,i,a){let n=document.createElement("div");function o(){c.$el.removeEventListener("selectFiles",r),c.$el.removeEventListener("abortSelect",s),l.unmount(),c.$el.remove()}function r(e){if(i){let a=[];for(let i=0;i<e.detail.length;i++)a.push(t.toRaw(e.detail[i]));i(t.toRaw(a))}o()}function s(e){a&&a(),o()}document.body.appendChild(n);const l=t.createApp(ea);l.directive("body-scroll-lock",da),l.use(ma(e));const c=l.mount(n);c.$el.addEventListener("selectFiles",r),c.$el.addEventListener("abortSelect",s)},Object.defineProperty(e,"__esModule",{value:!0}),e[Symbol.toStringTag]="Module"}));
